#!/bin/sh
set +x
set -e

# There is no docker0 interface on Mac OS, so don't do any proxy detection
if [ "$(uname)" != "Darwin" ]; then
    set +e
    DOCKER_ROUTE=$(ip -4 addr show docker0 | grep -Po 'inet \K[\d.]+')
    set -e
    export DOCKER_ROUTE
fi

# shellcheck disable=SC2086 disable=SC2048
docker run --rm \
    -v /etc/timezone:/etc/timezone:ro \
    -v /var/run/docker.sock:/var/run/docker.sock  \
    -v "$(pwd)":"$(pwd)" \
    -v "${HOME}"/.docker:/data/.docker \
    -w "$(pwd)" \
    docker/compose:1.11.2 \
    "$@"
